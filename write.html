<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸€ì“°ê¸° - GP-INSIDE</title>
    
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/buttons.css">
    <link rel="stylesheet" href="css/navbar.css">
    <style>
        .write-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
            min-height: calc(100vh - 80px);
        }

        .write-header {
            margin-bottom: 2rem;
        }

        .write-header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .write-header p {
            color: var(--text-secondary);
        }

        .write-form {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            font-weight: 600;
            font-size: 0.95rem;
        }

        .form-label .required {
            color: #ef4444;
        }

        .input-field {
            width: 100%;
            padding: 0.875rem 1rem;
            background: var(--input-bg);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.95rem;
            transition: all 0.2s;
            box-sizing: border-box;
            font-family: inherit;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        select.input-field {
            cursor: pointer;
        }

        textarea.input-field {
            min-height: 300px;
            resize: vertical;
            line-height: 1.6;
        }

        .input-hint {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
        }

        .form-actions button {
            padding: 0.875rem 2rem;
            font-size: 1rem;
            min-width: 120px;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.75rem;
        }

        .category-option {
            padding: 1rem;
            background: var(--input-bg);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .category-option:hover {
            border-color: var(--primary-color);
            background: rgba(102, 126, 234, 0.05);
        }

        .category-option.selected {
            border-color: var(--primary-color);
            background: rgba(102, 126, 234, 0.1);
        }

        .category-option input[type="radio"] {
            display: none;
        }

        .category-icon {
            font-size: 1.5rem;
        }

        .category-name {
            font-weight: 500;
            color: var(--text-primary);
        }

        .char-count {
            text-align: right;
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            display: none;
        }
    </style>
</head>
<body>
    <!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-left">
                <a href="index.html" style="text-decoration: none;">
                    <h1 class="logo">GP-INSIDE</h1>
                </a>
            </div>
            <div class="nav-right">
                <a href="index.html" class="btn-secondary">ì·¨ì†Œ</a>
            </div>
        </div>
    </nav>

    <div class="write-container">
        <div class="write-header">
            <h1>âœï¸ ìƒˆ ê²Œì‹œê¸€ ì‘ì„±</h1>
            <p>ì»¤ë®¤ë‹ˆí‹°ì™€ ìƒê°ì„ ë‚˜ëˆ ë³´ì„¸ìš”</p>
        </div>

        <div id="errorMessage" class="error-message"></div>

        <form class="write-form" onsubmit="handleSubmit(event)">
            <div class="form-group">
                <label class="form-label">
                    ì¹´í…Œê³ ë¦¬ <span class="required">*</span>
                </label>
                <div class="category-grid">
                    <label class="category-option selected">
                        <input type="radio" name="category" value="free" checked>
                        <span class="category-icon">ğŸ’¬</span>
                        <span class="category-name">ììœ ê²Œì‹œíŒ</span>
                    </label>
                    <label class="category-option">
                        <input type="radio" name="category" value="humor">
                        <span class="category-icon">ğŸ˜„</span>
                        <span class="category-name">ìœ ë¨¸</span>
                    </label>
                    <label class="category-option">
                        <input type="radio" name="category" value="tech">
                        <span class="category-icon">ğŸ’»</span>
                        <span class="category-name">ê¸°ìˆ </span>
                    </label>
                    <label class="category-option">
                        <input type="radio" name="category" value="game">
                        <span class="category-icon">ğŸ®</span>
                        <span class="category-name">ê²Œì„</span>
                    </label>
                    <label class="category-option">
                        <input type="radio" name="category" value="news">
                        <span class="category-icon">ğŸ“°</span>
                        <span class="category-name">ë‰´ìŠ¤</span>
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="title">
                    ì œëª© <span class="required">*</span>
                </label>
                <input 
                    type="text" 
                    id="title" 
                    class="input-field" 
                    placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
                    maxlength="100"
                    required
                >
                <div class="char-count"><span id="titleCount">0</span> / 100</div>
            </div>

            <div class="form-group">
                <label class="form-label" for="content">
                    ë‚´ìš© <span class="required">*</span>
                </label>
                <textarea 
                    id="content" 
                    class="input-field" 
                    placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”&#10;&#10;ì»¤ë®¤ë‹ˆí‹° ê·œì¹™ì„ ì§€ì¼œì£¼ì„¸ìš”:&#10;â€¢ ìƒëŒ€ë°©ì„ ì¡´ì¤‘í•˜ëŠ” ì–¸ì–´ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”&#10;â€¢ ë¶ˆë²•ì ì´ê±°ë‚˜ ìœ í•´í•œ ì½˜í…ì¸ ëŠ” ê¸ˆì§€ë©ë‹ˆë‹¤&#10;â€¢ ê´‘ê³ ë‚˜ ìŠ¤íŒ¸ì€ ì‚­ì œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤"
                    required
                ></textarea>
                <div class="char-count"><span id="contentCount">0</span>ì</div>
            </div>

            <div class="form-group">
                <label class="form-label" for="tags">
                    íƒœê·¸
                </label>
                <input 
                    type="text" 
                    id="tags" 
                    class="input-field" 
                    placeholder="íƒœê·¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì‰¼í‘œë¡œ êµ¬ë¶„)"
                >
                <div class="input-hint">ì˜ˆ: ì¶”ì²œ, ì§ˆë¬¸, ì •ë³´ê³µìœ </div>
            </div>

            <div class="form-actions">
                <a href="index.html" class="btn-secondary">ì·¨ì†Œ</a>
                <button type="submit" class="btn-primary">ê²Œì‹œí•˜ê¸°</button>
            </div>
        </form>
    </div>

    <script src="js/state.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/posts.js"></script>
    <script>
        // ë¡œê·¸ì¸ ì²´í¬
        if (!isLoggedIn()) {
            alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
            window.location.href = 'login.html';
        }

        // ì¹´í…Œê³ ë¦¬ ì„ íƒ UI
        document.querySelectorAll('.category-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.category-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                this.classList.add('selected');
                this.querySelector('input[type="radio"]').checked = true;
            });
        });

        // ê¸€ì ìˆ˜ ì¹´ìš´í„°
        const titleInput = document.getElementById('title');
        const contentInput = document.getElementById('content');
        const titleCount = document.getElementById('titleCount');
        const contentCount = document.getElementById('contentCount');

        titleInput.addEventListener('input', function() {
            titleCount.textContent = this.value.length;
        });

        contentInput.addEventListener('input', function() {
            contentCount.textContent = this.value.length;
        });

        // í¼ ì œì¶œ
        function handleSubmit(event) {
            event.preventDefault();
            
            const category = document.querySelector('input[name="category"]:checked').value;
            const title = titleInput.value.trim();
            const content = contentInput.value.trim();
            const tags = document.getElementById('tags').value.trim();
            
            const errorMsg = document.getElementById('errorMessage');
            errorMsg.style.display = 'none';
            
            if (!title) {
                errorMsg.textContent = 'ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                errorMsg.style.display = 'block';
                titleInput.focus();
                return;
            }
            
            if (!content) {
                errorMsg.textContent = 'ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                errorMsg.style.display = 'block';
                contentInput.focus();
                return;
            }
            
            if (content.length < 10) {
                errorMsg.textContent = 'ë‚´ìš©ì„ 10ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                errorMsg.style.display = 'block';
                contentInput.focus();
                return;
            }
            
            // ê²Œì‹œê¸€ ìƒì„±
            createNewPost(category, title, content, tags);
            
            // ì„±ê³µ ë©”ì‹œì§€ í›„ ë©”ì¸ìœ¼ë¡œ ì´ë™
            alert('ê²Œì‹œê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
            window.location.href = 'index.html';
        }

        // í˜ì´ì§€ ë‚˜ê°€ê¸° ì „ í™•ì¸
        let formChanged = false;
        
        titleInput.addEventListener('input', () => formChanged = true);
        contentInput.addEventListener('input', () => formChanged = true);
        
        window.addEventListener('beforeunload', function(e) {
            if (formChanged && titleInput.value.trim() || contentInput.value.trim()) {
                e.preventDefault();
                e.returnValue = '';
            }
        });
    </script>
</body>
</html>
